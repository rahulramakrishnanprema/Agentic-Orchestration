# Deployment Document for **INVEST-001**

## Metadata
- **Issue Key:** INVEST-001  
- **Summary:** Investment Portfolio Management  
- **Created At:** 2025-10-20T12:00:00Z  
- **Version:** 1.0  

## Project Overview
- **Description:** A minimal viable product web application for advisors to view and manage Indian equity client portfolios. The system stores portfolio, holdings and transaction data in SQLite, calculates simple advisory signals (Buy/Hold/Sell) using SMA, sector weighting and a mock market‑buzz score, and presents the information through a React UI with charts and PDF report generation.  
- **Project Type:** web app (frontend React + backend Express API)  
- **Architecture:** Monorepo with three logical layers: `frontend/`, `backend/`, `shared/`. The backend follows a thin‑controller / service / DAL pattern.  

## Implementation Plan
### Subtasks
1. **Subtask 1:** Initialize the project repository and establish the minimal tech stack. Set up a monorepo‑style folder layout (`frontend/`, `backend/`, `shared/`), create core configuration files (`package.json`, `vite.config.js`, `.gitignore`, `README`), and configure Vite + React for the UI and Node.js + Express with SQLite for the API.  
2. **Subtask 2:** Design and implement the data model for client portfolios. Create SQLite schema scripts for portfolios, holdings, and transactions, seed the database with realistic dummy Indian‑equity data (ticker, sector, purchase price, quantity), and expose a clean data‑access layer (DAL) in the backend for all CRUD operations.  
3. **Subtask 3:** Develop the core backend functionality. Implement RESTful Express routes for portfolio CRUD, a health‑check endpoint, and a signals endpoint. Integrate the DAL from Task 2 and embed the advisory signal engine (SMA calculation, sector‑weight factor, mock market‑buzz score) to return Buy/Hold/Sell recommendations. Add CORS, basic error handling, and JSON response formatting.  
4. **Subtask 4:** Build the advisor user interface and reporting features. Create a login placeholder, portfolio list page, and portfolio detail view using React functional components, React Router, and Tailwind CSS. Add visual reporting components (allocation pie chart, performance line chart, advisory‑signal summary card) with Chart.js, and provide a “Download Report” button that generates a PDF via jsPDF containing the charts and key metrics. Wire all UI elements to the backend APIs from Task 3.  

### Execution Order
1. Subtask 1  
2. Subtask 2  
3. Subtask 3  
4. Subtask 4  

### Dependencies
- **Subtask 2:** depends on **Subtask 1**  
- **Subtask 3:** depends on **Subtask 2**  
- **Subtask 4:** depends on **Subtask 3**  

### Parallel Groups
- *None* (all tasks are sequential).  

### Critical Path
1 → 2 → 3 → 4  

## File Structure
### Files
| Filename | Type | Purpose |
|----------|------|---------|
| `package.json` | json | Defines project dependencies, scripts for both frontend and backend, and workspace configuration. |
| `vite.config.js` | javascript | Configures Vite to serve the React frontend and resolve shared aliases. |
| `.gitignore` | text | Excludes `node_modules`, build artifacts, and SQLite DB file from version control. |
| `README.md` | markdown | Provides project overview, setup, and run instructions. |
| `frontend/src/main.jsx` | javascript | Entry point that mounts the React app. |
| `frontend/src/App.jsx` | javascript | Root component that includes routing. |
| `frontend/src/router.jsx` | javascript | Defines React Router routes for login, portfolio list, and detail pages. |
| `frontend/src/pages/Login.jsx` | javascript | Placeholder login page (no auth logic). |
| `frontend/src/pages/PortfolioList.jsx` | javascript | Displays list of client portfolios fetched from the backend. |
| `frontend/src/pages/PortfolioDetail.jsx` | javascript | Shows holdings, charts, signal card and report button for a selected portfolio. |
| `frontend/src/components/AllocationChart.jsx` | javascript | Renders a pie chart of sector allocation using Chart.js. |
| `frontend/src/components/PerformanceChart.jsx` | javascript | Renders a line chart of portfolio value over time using Chart.js. |
| `frontend/src/components/SignalCard.jsx` | javascript | Displays Buy/Hold/Sell recommendation returned by the signals API. |
| `frontend/src/components/ReportButton.jsx` | javascript | Generates a PDF report with jsPDF that embeds the two charts and key metrics. |
| `frontend/src/index.css` | css | Tailwind CSS base styles. |
| `backend/src/server.js` | javascript | Initializes Express app, applies middleware, and registers all route modules. |
| `backend/src/config.js` | javascript | Holds configuration constants such as DB path and server port. |
| `backend/src/routes/healthRoutes.js` | javascript | Provides a simple health‑check endpoint. |
| `backend/src/routes/portfolioRoutes.js` | javascript | Implements CRUD endpoints for portfolios, holdings and transactions. |
| `backend/src/routes/signalRoutes.js` | javascript | Exposes `/api/signals/:portfolioId` that returns advisory recommendation. |
| `backend/src/dal/database.js` | javascript | Creates and exports a singleton SQLite database connection. |
| `backend/src/dal/portfolioDAL.js` | javascript | Provides functions to query and manipulate portfolio, holdings and transaction tables. |
| `backend/src/utils/signalEngine.js` | javascript | Contains the advisory algorithm (SMA, sector weight, mock buzz) and returns a signal string. |
| `backend/db/schema.sql` | sql | SQLite schema defining tables: portfolios, holdings, transactions. |
| `backend/db/seed.sql` | sql | Inserts dummy Indian‑equity data for testing. |

### Folder Structure
```
root
├─ frontend
│  └─ src
│     ├─ pages
│     └─ components
├─ backend
│  ├─ src
│  │  ├─ routes
│  │  ├─ dal
│  │  └─ utils
│  └─ db
└─ shared
```

### File Types
- `json`
- `javascript`
- `css`
- `markdown`
- `sql`

## Technical Specifications
### package.json
- **Imports:** –  
- **Classes:** –  
- **Functions:** – (scripts that call Vite for the frontend and Nodemon for the backend)  
- **Data Structures:** –  
- **Logic Flows:** Defines npm scripts for `dev:frontend`, `dev:backend`, `build:frontend`, etc.; sets up a workspace so both frontend and backend share the same `node_modules`.  
- **Error Handling:** –  
- **Connections:** Scripts are invoked by developers; no runtime code connections.  

### vite.config.js
- **Imports:** `defineConfig` from `vite`; `react` from `@vitejs/plugin-react`  
- **Classes:** –  
- **Functions:** `defineConfig({ plugins: [react()], resolve: { alias: { '@frontend': path.resolve(__dirname, 'frontend/src') } } })`  
- **Data Structures:** –  
- **Logic Flows:** Exports Vite configuration enabling React JSX transformation and alias resolution.  
- **Error Handling:** –  
- **Connections:** Frontend source files can import using `@frontend/...` which resolves via this alias.  

### .gitignore
- **Purpose:** Excludes `node_modules/`, `dist/`, `build/`, and `backend/db/portfolio.db` from version control.  

### README.md
- **Purpose:** Provides project overview, prerequisites, setup, build, and run instructions.  

### frontend/src/main.jsx
- **Imports:** `React` from `react`; `ReactDOM` from `react-dom/client`; `App` from `./App.jsx`  
- **Functions:** `ReactDOM.createRoot(document.getElementById('root')).render(<React.StrictMode><App /></React.StrictMode>)`  
- **Logic Flows:** Boots the React app by rendering `App` into the root DOM node.  
- **Connections:** Calls `App.jsx`, which in turn loads `router.jsx`.  

### frontend/src/App.jsx
- **Imports:** `BrowserRouter` from `react-router-dom`; `Router` from `./router.jsx`  
- **Functions:** `function App() { return (<BrowserRouter><Router /></BrowserRouter>); } export default App;`  
- **Logic Flows:** Wraps the UI with `BrowserRouter` and renders the route configuration.  
- **Connections:** `Router.jsx` defines the mapping of URLs to page components.  

### frontend/src/router.jsx
- **Imports:** `Routes`, `Route` from `react-router-dom`; page components (`Login`, `PortfolioList`, `PortfolioDetail`)  
- **Functions:** `function Router() { return ( <Routes> <Route path='/' element={<Login/>}/> <Route path='/portfolios' element={<PortfolioList/>}/> <Route path='/portfolios/:id' element={<PortfolioDetail/>}/> </Routes> ); } export default Router;`  
- **Logic Flows:** Maps URLs to corresponding page components.  
- **Connections:** Each page component fetches data from backend routes.  

### frontend/src/pages/Login.jsx
- **Imports:** `useNavigate` from `react-router-dom`  
- **Functions:** Renders a button that navigates to `/portfolios`.  
- **Logic Flows:** Simple entry point; no authentication.  

### frontend/src/pages/PortfolioList.jsx
- **Imports:** `useEffect`, `useState` from `react`; `Link` from `react-router-dom`; `axios` from `axios`  
- **Functions:** On mount, `axios.get('/api/portfolios')` → stores result in state → renders list with links to detail view.  
- **Data Structures:** `portfolios` – array of `{ id, name, clientName }`  
- **Error Handling:** Logs errors to console.  
- **Connections:** Calls backend `GET /api/portfolios` (implemented in `backend/src/routes/portfolioRoutes.js`).  

### frontend/src/pages/PortfolioDetail.jsx
- **Imports:** `useParams`, `useEffect`, `useState` from `react-router-dom`; `axios`; UI components (`AllocationChart`, `PerformanceChart`, `SignalCard`, `ReportButton`)  
- **Functions:** Fetches portfolio details (`/api/portfolios/:id`) and advisory signal (`/api/signals/:id`) in parallel; renders charts, signal card, and report button.  
- **Data Structures:** `portfolio` object with `holdings`; `signal` string.  
- **Connections:**  
  - `GET /api/portfolios/:id` → `backend/src/routes/portfolioRoutes.js`  
  - `GET /api/signals/:id` → `backend/src/routes/signalRoutes.js`  
  - Charts receive `holdings` as props; `ReportButton` receives `portfolio` and `signal`.  

### frontend/src/components/AllocationChart.jsx
- **Imports:** `useEffect`, `useRef` from `react`; `Chart` from `chart.js/auto`  
- **Functions:** Aggregates market value per sector from `holdings`, creates a pie chart on a canvas.  
- **Data Structures:** `holdings` – array of `{ ticker, sector, quantity, currentPrice }`  
- **Connections:** Receives `holdings` from `PortfolioDetail`; no direct backend call.  

### frontend/src/components/PerformanceChart.jsx
- **Imports:** `useEffect`, `useRef` from `react`; `Chart` from `chart.js/auto`  
- **Functions:** Generates a mock 12‑month portfolio‑value series (2 % monthly increase per holding) and renders a line chart.  
- **Connections:** Purely client‑side; uses `holdings` prop.  

### frontend/src/components/SignalCard.jsx
- **Functions:** Displays the advisory recommendation with colour coding (`Buy` → green, `Hold` → gray, `Sell` → red).  
- **Connections:** Receives `recommendation` prop from `PortfolioDetail`.  

### frontend/src/components/ReportButton.jsx
- **Imports:** `jsPDF` from `jspdf`; `html2canvas` from `html2canvas`  
- **Functions:** On click, captures the two canvas elements, adds them to a PDF, writes portfolio name and recommendation, and triggers download.  
- **Connections:** Uses DOM to locate the charts rendered by `AllocationChart` and `PerformanceChart`; no backend interaction.  

### frontend/src/index.css
- **Purpose:** Tailwind CSS base styles for the UI.  

### backend/src/config.js
- **Functions:** Exports `CONFIG = { DB_PATH: './backend/db/portfolio.db', PORT: process.env.PORT || 4000 }`.  
- **Connections:** Imported by `database.js` (to open SQLite) and `server.js` (to set listening port).  

### backend/src/dal/database.js
- **Imports:** `sqlite3` from `sqlite3`; `CONFIG` from `../config.js`  
- **Functions:** Creates a singleton `db` instance (`new sqlite3.Database(CONFIG.DB_PATH, ...)`).  
- **Connections:** Exported to all DAL modules (e.g., `portfolioDAL.js`).  

### backend/src/dal/portfolioDAL.js
- **Functions:**  
  - `getAllPortfolios(callback)` – returns list of portfolios.  
  - `getPortfolioById(id, callback)` – returns portfolio with its holdings.  
  - `createPortfolio(portfolio, callback)` – inserts a new portfolio.  
  - `updatePortfolio(id, updates, callback)` – updates fields.  
  - `deletePortfolio(id, callback)` – removes a portfolio.  
- **Connections:** Used by `backend/src/routes/portfolioRoutes.js`.  

### backend/src/utils/signalEngine.js
- **Functions:**  
  - `calculateSMA(prices, period)` – simple moving average.  
  - `sectorWeightFactor(sector)` – returns 1.1 for high‑growth sectors.  
  - `mockBuzzScore(ticker)` – deterministic pseudo‑random score.  
  - `generateRecommendation(holdings)` – combines SMA, sector factor, buzz score → returns `'Buy' | 'Hold' | 'Sell'`.  
- **Connections:** Invoked by `backend/src/routes/signalRoutes.js`.  

### backend/src/routes/healthRoutes.js
- **Functions:** `GET /health` → `{ status: 'OK', timestamp: ... }`.  
- **Connections:** Mounted under `/api` in `server.js`.  

### backend/src/routes/portfolioRoutes.js
- **Functions:**  
  - `GET /portfolios` → list all portfolios.  
  - `GET /portfolios/:id` → portfolio with holdings.  
  - `POST /portfolios` → create.  
  - `PUT /portfolios/:id` → update.  
  - `DELETE /portfolios/:id` → delete.  
- **Connections:** Calls DAL functions from `portfolioDAL.js`; mounted under `/api`.  

### backend/src/routes/signalRoutes.js
- **Functions:** `GET /signals/:portfolioId` → fetches portfolio via DAL, runs `signalEngine.generateRecommendation`, returns `{ recommendation }`.  
- **Connections:** Uses `portfolioDAL` and `signalEngine`; mounted under `/api`.  

### backend/src/server.js
- **Functions:**  
  - Creates Express app, applies `cors` and JSON body parser.  
  - Registers `/api` routes: health, portfolio, signal.  
  - Adds generic 404 and error handlers.  
  - Starts listening on `CONFIG.PORT`.  
- **Connections:** Imports all route modules; uses `CONFIG` for the port.  

### backend/db/schema.sql
- **SQL Statements:**  
  - `CREATE TABLE portfolios (id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, client_name TEXT NOT NULL);`  
  - `CREATE TABLE holdings (id INTEGER PRIMARY KEY AUTOINCREMENT, portfolio_id INTEGER NOT NULL, ticker TEXT NOT NULL, sector TEXT NOT NULL, quantity INTEGER NOT NULL, purchase_price REAL NOT NULL, current_price REAL NOT NULL, FOREIGN KEY(portfolio_id) REFERENCES portfolios(id));`  
  - `CREATE TABLE transactions (id INTEGER PRIMARY KEY AUTOINCREMENT, holding_id INTEGER NOT NULL, type TEXT NOT NULL, shares INTEGER NOT NULL, price REAL NOT NULL, date TEXT NOT NULL, FOREIGN KEY(holding_id) REFERENCES holdings(id));`  
- **Connections:** Executed once to create the SQLite schema before the server starts.  

### backend/db/seed.sql
- **SQL Inserts:**  
  - `INSERT INTO portfolios (name, client_name) VALUES ('Growth Fund', 'Acme Corp');`  
  - `INSERT INTO holdings (portfolio_id, ticker, sector, quantity, purchase_price, current_price) VALUES (1,